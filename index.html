<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-FREE Key Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1000px;
            width: 100%;
            padding: 40px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .setup-section {
            background: #e3f2fd;
            border-left-color: #2196f3;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        input[type="text"],
        input[type="number"],
        input[type="password"] {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            flex: 1;
            min-width: 200px;
        }

        input[type="number"] {
            flex: none;
            width: 120px;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .key-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 2px solid #e0e0e0;
            max-height: 400px;
            overflow-y: auto;
        }

        .key-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .key-text {
            font-family: 'Courier New', monospace;
            color: #333;
            font-size: 0.95em;
            flex: 1;
        }

        .key-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            color: #999;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert.show {
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.connected {
            background: #2ecc71;
        }

        .status-indicator.disconnected {
            background: #e74c3c;
        }

        .github-url {
            background: #2c3e50;
            color: #2ecc71;
            padding: 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            margin: 10px 0;
            font-size: 0.9em;
        }

        .instructions {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .instructions h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .instructions ol, .instructions ul {
            margin-left: 20px;
            color: #856404;
        }

        .instructions li {
            margin: 8px 0;
        }

        .instructions code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }

        .instructions a {
            color: #0066cc;
            text-decoration: none;
        }

        .instructions a:hover {
            text-decoration: underline;
        }

        .highlight-box {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .highlight-box h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .highlight-box p {
            color: #2e7d32;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîë X-FREE Key Manager</h1>
            <p>Auto-sync with GitHub - Generate unlimited keys!</p>
        </div>

        <div id="alert" class="alert"></div>

        <!-- GitHub Setup Section -->
        <div class="section setup-section" id="setupSection">
            <h2>‚öôÔ∏è GitHub Setup (One-Time Configuration)</h2>
            <p style="color: #666; margin-bottom: 15px;">Configure once, then generate keys forever!</p>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">GitHub Personal Access Token:</label>
                <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" style="width: 100%;">
                <p style="color: #666; font-size: 0.9em; margin-top: 5px;">Create at: Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic) ‚Üí Generate new token</p>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Repository (username/repo):</label>
                <input type="text" id="githubRepo" placeholder="yourusername/xfree-keys" style="width: 100%;">
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">File Path:</label>
                <input type="text" id="githubFilePath" value="keys.txt" style="width: 100%;">
            </div>

            <button class="btn-success" onclick="saveGitHubConfig()">üíæ Save Configuration</button>
            <button class="btn-primary" onclick="testGitHubConnection()">üîå Test Connection</button>
            
            <div id="connectionStatus" style="margin-top: 15px; display: none;">
                <span class="status-indicator disconnected"></span>
                <span>Not connected</span>
            </div>

            <div class="instructions" style="margin-top: 20px;">
                <h3>üìñ Quick Setup Guide</h3>
                <ol>
                    <li><strong>Create a GitHub repository:</strong>
                        <ul>
                            <li>Go to <a href="https://github.com/new" target="_blank">GitHub ‚Üí New Repository</a></li>
                            <li>Name it (e.g., "xfree-keys")</li>
                            <li>Make it <strong>Public</strong></li>
                            <li>Click "Create repository"</li>
                        </ul>
                    </li>
                    <li><strong>Create a Personal Access Token:</strong>
                        <ul>
                            <li>Go to <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)</a></li>
                            <li>Click "Generate new token (classic)"</li>
                            <li>Name it "X-FREE Key Manager"</li>
                            <li>Select scope: <strong>repo</strong> (full control)</li>
                            <li>Click "Generate token" and copy it</li>
                        </ul>
                    </li>
                    <li><strong>Fill in the form above</strong> with your token and repository</li>
                    <li><strong>Click "Save Configuration"</strong> - Done!</li>
                </ol>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats" id="statsSection" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="keyCount">0</div>
                <div class="stat-label">Active Keys</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalGenerated">0</div>
                <div class="stat-label">Total Generated</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="syncStatus">‚è≥</div>
                <div class="stat-label">Last Sync</div>
            </div>
        </div>

        <!-- Key Generation Section -->
        <div class="section" id="generateSection" style="display: none;">
            <h2>üéØ Generate Keys</h2>
            <div class="button-group">
                <button class="btn-primary" onclick="generateKeys(1)">Generate 1</button>
                <button class="btn-primary" onclick="generateKeys(5)">Generate 5</button>
                <button class="btn-primary" onclick="generateKeys(10)">Generate 10</button>
                <button class="btn-primary" onclick="generateKeys(25)">Generate 25</button>
                <button class="btn-primary" onclick="generateKeys(50)">Generate 50</button>
                <button class="btn-primary" onclick="generateKeys(100)">Generate 100</button>
            </div>
            
            <div class="input-group">
                <input type="number" id="customAmount" placeholder="Amount" min="1" max="10000" value="10">
                <button class="btn-success" onclick="generateCustom()">Generate Custom Amount</button>
            </div>

            <button class="btn-success" style="margin-top: 10px;" onclick="syncToGitHub()">üîÑ Sync to GitHub Now</button>
        </div>

        <!-- Keys Display Section -->
        <div class="section" id="keysSection" style="display: none;">
            <h2>üìã Active Keys (<span id="keyCount2">0</span>)</h2>
            <div class="button-group">
                <button class="btn-primary" onclick="copyAllKeys()">üìã Copy All</button>
                <button class="btn-success" onclick="exportKeys()">üíæ Export</button>
                <button class="btn-danger" onclick="clearAllKeys()">üóëÔ∏è Clear All</button>
            </div>
            <div id="keyList" class="key-display">
                <div class="empty-state">No keys generated yet</div>
            </div>
        </div>

        <!-- GitHub URL Section -->
        <div class="section" id="urlSection" style="display: none;">
            <h2>üîó Your GitHub Raw URL</h2>
            <p style="color: #666; margin-bottom: 10px;">Copy this URL and paste it into your Roblox script's <code>VALID_KEYS_URL</code></p>
            <div class="github-url" id="githubRawUrl">Configure GitHub first</div>
            <button class="btn-success" onclick="copyGitHubUrl()">üìã Copy GitHub URL</button>

            <div class="highlight-box">
                <h4>‚úÖ You're All Set!</h4>
                <p>Every time you generate keys, they automatically sync to GitHub.</p>
                <p>Your Roblox script will fetch the latest keys automatically!</p>
            </div>
        </div>
    </div>

    <script>
        let keys = new Set();
        let totalGenerated = 0;
        let config = {
            token: '',
            repo: '',
            filePath: 'keys.txt',
            sha: '' // For updating existing files
        };

        // Load everything on start
        function init() {
            loadConfig();
            loadKeys();
            updateDisplay();
            checkSetupComplete();
        }

        function loadConfig() {
            const saved = localStorage.getItem('github_config');
            if (saved) {
                config = JSON.parse(saved);
            }
        }

        function saveConfig() {
            localStorage.setItem('github_config', JSON.stringify(config));
        }

        function loadKeys() {
            const saved = localStorage.getItem('xfree_keys');
            const savedTotal = localStorage.getItem('xfree_total');
            if (saved) {
                keys = new Set(JSON.parse(saved));
            }
            if (savedTotal) {
                totalGenerated = parseInt(savedTotal);
            }
        }

        function saveKeys() {
            localStorage.setItem('xfree_keys', JSON.stringify([...keys]));
            localStorage.setItem('xfree_total', totalGenerated.toString());
        }

        function saveGitHubConfig() {
            const token = document.getElementById('githubToken').value.trim();
            const repo = document.getElementById('githubRepo').value.trim();
            const filePath = document.getElementById('githubFilePath').value.trim();

            if (!token || !repo || !filePath) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            config.token = token;
            config.repo = repo;
            config.filePath = filePath;
            saveConfig();

            showAlert('Configuration saved! Click "Test Connection" to verify.', 'success');
            checkSetupComplete();
        }

        async function testGitHubConnection() {
            if (!config.token || !config.repo) {
                showAlert('Please save configuration first', 'error');
                return;
            }

            showAlert('Testing connection...', 'info');

            try {
                const response = await fetch(`https://api.github.com/repos/${config.repo}`, {
                    headers: {
                        'Authorization': `token ${config.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    showAlert('‚úÖ Connection successful!', 'success');
                    const statusDiv = document.getElementById('connectionStatus');
                    statusDiv.style.display = 'block';
                    statusDiv.innerHTML = '<span class="status-indicator connected"></span><span>Connected to GitHub</span>';
                    checkSetupComplete();
                } else {
                    showAlert('‚ùå Connection failed. Check your token and repository name.', 'error');
                }
            } catch (error) {
                showAlert('‚ùå Connection error: ' + error.message, 'error');
            }
        }

        function checkSetupComplete() {
            if (config.token && config.repo && config.filePath) {
                document.getElementById('statsSection').style.display = 'grid';
                document.getElementById('generateSection').style.display = 'block';
                document.getElementById('keysSection').style.display = 'block';
                document.getElementById('urlSection').style.display = 'block';
                updateGitHubUrl();
            }
        }

        function updateGitHubUrl() {
            const url = `https://raw.githubusercontent.com/${config.repo}/main/${config.filePath}`;
            document.getElementById('githubRawUrl').textContent = url;
        }

        function copyGitHubUrl() {
            const url = `https://raw.githubusercontent.com/${config.repo}/main/${config.filePath}`;
            navigator.clipboard.writeText(url).then(() => {
                showAlert('GitHub URL copied! Paste it into your Roblox script.', 'success');
            });
        }

        function generateRandomKey() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            const segments = [];
            for (let i = 0; i < 4; i++) {
                let segment = '';
                for (let j = 0; j < 4; j++) {
                    segment += chars[Math.floor(Math.random() * chars.length)];
                }
                segments.push(segment);
            }
            return 'XFREE-' + segments.join('-');
        }

        async function generateKeys(count) {
            const startSize = keys.size;
            for (let i = 0; i < count; i++) {
                keys.add(generateRandomKey());
            }
            const newKeys = keys.size - startSize;
            totalGenerated += newKeys;
            saveKeys();
            updateDisplay();
            showAlert(`Generated ${newKeys} keys. Syncing to GitHub...`, 'info');
            await syncToGitHub();
        }

        async function generateCustom() {
            const count = parseInt(document.getElementById('customAmount').value);
            if (isNaN(count) || count < 1) {
                showAlert('Please enter a valid number', 'error');
                return;
            }
            await generateKeys(count);
        }

        async function syncToGitHub() {
            if (!config.token || !config.repo) {
                showAlert('Please configure GitHub first', 'error');
                return;
            }

            if (keys.size === 0) {
                // Allow syncing empty state to delete all keys
                const content = '';
                const encodedContent = btoa(content);
                
                try {
                    // Check if file exists
                    let currentSha = '';
                    const getResponse = await fetch(`https://api.github.com/repos/${config.repo}/contents/${config.filePath}`, {
                        headers: {
                            'Authorization': `token ${config.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (getResponse.ok) {
                        const fileData = await getResponse.json();
                        currentSha = fileData.sha;
                    } else {
                        showAlert('No file to sync (empty keys)', 'info');
                        return;
                    }

                    // Update file with empty content
                    const body = {
                        message: `Clear all keys`,
                        content: encodedContent,
                        branch: 'main',
                        sha: currentSha
                    };

                    const response = await fetch(`https://api.github.com/repos/${config.repo}/contents/${config.filePath}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${config.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(body)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        config.sha = data.content.sha;
                        saveConfig();
                        showAlert('‚úÖ All keys cleared from GitHub!', 'success');
                        document.getElementById('syncStatus').textContent = '‚úÖ';
                    } else {
                        const error = await response.json();
                        showAlert('‚ùå Sync failed: ' + (error.message || 'Unknown error'), 'error');
                    }
                } catch (error) {
                    showAlert('‚ùå Sync error: ' + error.message, 'error');
                }
                return;
            }

            const content = [...keys].join('\n');
            const encodedContent = btoa(content);

            try {
                // Check if file exists
                let fileExists = false;
                let currentSha = '';

                const getResponse = await fetch(`https://api.github.com/repos/${config.repo}/contents/${config.filePath}`, {
                    headers: {
                        'Authorization': `token ${config.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    currentSha = fileData.sha;
                    fileExists = true;
                }

                // Create or update file
                const body = {
                    message: `Update keys: ${keys.size} total keys`,
                    content: encodedContent,
                    branch: 'main'
                };

                if (fileExists) {
                    body.sha = currentSha;
                }

                const response = await fetch(`https://api.github.com/repos/${config.repo}/contents/${config.filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${config.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                if (response.ok) {
                    const data = await response.json();
                    config.sha = data.content.sha; // Save SHA for future updates
                    saveConfig();
                    showAlert('‚úÖ Keys synced to GitHub successfully!', 'success');
                    document.getElementById('syncStatus').textContent = '‚úÖ';
                    updateGitHubUrl();
                } else {
                    const error = await response.json();
                    showAlert('‚ùå Sync failed: ' + (error.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('‚ùå Sync error: ' + error.message, 'error');
            }
        }

        async function deleteKey(key) {
            keys.delete(key);
            saveKeys();
            updateDisplay();
            showAlert('Key deleted. Syncing to GitHub...', 'info');
            await syncToGitHub();
        }

        function copyKey(key) {
            navigator.clipboard.writeText(key).then(() => {
                showAlert('Key copied!', 'success');
            });
        }

        function copyAllKeys() {
            if (keys.size === 0) {
                showAlert('No keys to copy', 'error');
                return;
            }
            navigator.clipboard.writeText([...keys].join('\n')).then(() => {
                showAlert(`Copied ${keys.size} keys!`, 'success');
            });
        }

        function exportKeys() {
            if (keys.size === 0) {
                showAlert('No keys to export', 'error');
                return;
            }
            const blob = new Blob([[...keys].join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `xfree-keys-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            showAlert('Keys exported!', 'success');
        }

        async function clearAllKeys() {
            if (keys.size === 0) {
                showAlert('No keys to clear', 'error');
                return;
            }
            if (confirm(`Delete all ${keys.size} keys? This will sync to GitHub immediately.`)) {
                keys.clear();
                saveKeys();
                updateDisplay();
                showAlert('Clearing all keys and syncing to GitHub...', 'info');
                await syncToGitHub();
            }
        }

        function updateDisplay() {
            document.getElementById('keyCount').textContent = keys.size;
            document.getElementById('keyCount2').textContent = keys.size;
            document.getElementById('totalGenerated').textContent = totalGenerated;

            const keyList = document.getElementById('keyList');
            if (keys.size === 0) {
                keyList.innerHTML = '<div class="empty-state">No keys generated yet</div>';
            } else {
                keyList.innerHTML = '';
                [...keys].forEach(key => {
                    const item = document.createElement('div');
                    item.className = 'key-item';
                    item.innerHTML = `
                        <span class="key-text">${key}</span>
                        <div class="key-actions">
                            <button class="btn-primary btn-small" onclick="copyKey('${key}')">üìã</button>
                            <button class="btn-danger btn-small" onclick="deleteKey('${key}')">üóëÔ∏è</button>
                        </div>
                    `;
                    keyList.appendChild(item);
                });
            }
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type} show`;
            setTimeout(() => alert.classList.remove('show'), 4000);
        }

        init();
    </script>
</body>
</html>
